compute_engine_instance:
  platform: freebsd
  image_project: freebsd-org-cloud-dev
  image: freebsd-13-0-release-amd64
  cpu: 1
  memory: 4G

task:
  name: Test all packages in the PKG repository build
  setup_script:
  - uname -a
  - df -h
  - echo "Add Linux support to kernel üêß"
  - kldload linux64
  - kldstat
  - mkdir -p /usr/local/etc/pkg/repos
  - cp ci/FreeBSD.conf /usr/local/etc/pkg/repos
  - mkdir -p /usr/ports/Keywords
  - cp ci/*.ucl /usr/ports/Keywords
  install_script:
  - pkg install -y pkgconf pango librsvg2-rust icu git-lite libxcb xcb-util xcb-util-wm xcb-util-image xcb libX11 mesa-libs glew libXcomposite libXfixes libXinerama # TODO what was glew for again?
  script:
  - sh build.sh aquabsd.alps nvidia
  post_script:
  - ls -la .build/
  - df -h
  packages_artifacts:
    path: ".build/*"
